---
import { info } from "@data";
import { IClient } from "@types";

const clients = info.clients || [];

// Only show clients that have logos
const clientsWithLogos = clients.filter((client: IClient) => client.logo);

// Duplicate clients array multiple times for seamless infinite loop
// We need enough duplicates to ensure smooth looping
const duplicatedClients = [...clientsWithLogos, ...clientsWithLogos, ...clientsWithLogos];
---

{clientsWithLogos.length > 0 && (
  <section 
    class="clients-logos-section py-12 sm:py-16 lg:py-20"
    aria-labelledby="clients-logos-heading"
  >
    <div class="container-sm">
      <!-- Section Header -->
      <div class="text-center mb-8 sm:mb-12">
        <h2 
          id="clients-logos-heading"
          class="text-2xl sm:text-3xl font-bold text-dark dark:text-light mb-2"
        >
          Trusted By
        </h2>
        <p class="text-sm sm:text-base text-dark/70 dark:text-light/70">
          Companies I've had the privilege to work with
        </p>
      </div>

      <!-- Logo Slider Container -->
      <div 
        class="logo-slider-container"
        role="region"
        aria-label="Client logos carousel"
        aria-live="polite"
      >
        <div 
          class="logo-slider-wrapper"
          id="logo-slider-wrapper"
        >
          <div 
            class="logo-slider-track"
            id="logo-slider-track"
            aria-label="Scrolling client logos"
          >
            <!-- Logo items - duplicated for seamless loop -->
            {duplicatedClients.map((client: IClient, index: number) => (
              <div 
                class="logo-slide-item"
                key={`${client.id}-${index}`}
              >
                <a
                  href={client.website || `/clients#${client.id}`}
                  target={client.website ? "_blank" : undefined}
                  rel={client.website ? "noopener noreferrer" : undefined}
                  class="logo-link"
                  aria-label={`Visit ${client.name} website - ${client.industry}`}
                >
                  <img
                    src={client.logo}
                    alt={`${client.name} logo`}
                    class="logo-image"
                    loading="lazy"
                    width="120"
                    height="60"
                  />
                </a>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>
)}

<style>
  .clients-logos-section {
    background: rgba(247, 249, 254, 0.5);
  }

  .dark .clients-logos-section {
    background: rgba(26, 26, 26, 0.5);
  }

  .logo-slider-container {
    position: relative;
    overflow: hidden;
    width: 100%;
    margin: 0 auto;
  }

  .logo-slider-wrapper {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .logo-slider-track {
    display: flex;
    gap: 3rem;
    animation: slide-infinite 40s linear infinite;
    will-change: transform;
  }

  /* Pause on hover */
  .logo-slider-container:hover .logo-slider-track {
    animation-play-state: paused;
  }

  /* Pause on focus within */
  .logo-slider-container:focus-within .logo-slider-track {
    animation-play-state: paused;
  }

  .logo-slide-item {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Responsive widths */
    width: calc(100% - 2rem); /* Mobile: 1 logo */
    min-width: calc(100% - 2rem);
  }

  .logo-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 80px;
    padding: 1rem;
    opacity: 0.6;
    transition: opacity 0.3s ease, transform 0.3s ease;
    border-radius: 0.5rem;
    outline: none;
  }

  .logo-link:hover,
  .logo-link:focus {
    opacity: 1;
    transform: scale(1.05);
    outline: 2px solid rgba(61, 64, 58, 0.3);
    outline-offset: 4px;
  }

  .dark .logo-link:focus {
    outline-color: rgba(135, 139, 128, 0.3);
  }

  .logo-image {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    filter: grayscale(100%);
    transition: filter 0.3s ease;
  }

  .logo-link:hover .logo-image,
  .logo-link:focus .logo-image {
    filter: grayscale(0%);
  }

  /* Animation */
  @keyframes slide-infinite {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(calc(-100% / 3));
    }
  }

  /* Tablet: 2 logos visible */
  @media (min-width: 800px) {
    .logo-slide-item {
      width: calc(50% - 1.5rem); /* 2 logos */
      min-width: calc(50% - 1.5rem);
    }

    @keyframes slide-infinite {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(calc(-100% / 2));
      }
    }
  }

  /* Desktop: 3 logos visible */
  @media (min-width: 1280px) {
    .logo-slide-item {
      width: calc(33.333% - 2rem); /* 3 logos */
      min-width: calc(33.333% - 2rem);
    }

    @keyframes slide-infinite {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(calc(-100% / 3));
      }
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .logo-slider-track {
      animation: none;
      overflow-x: auto;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: rgba(61, 64, 58, 0.3) transparent;
    }

    .logo-slider-track::-webkit-scrollbar {
      height: 6px;
    }

    .logo-slider-track::-webkit-scrollbar-track {
      background: transparent;
    }

    .logo-slider-track::-webkit-scrollbar-thumb {
      background-color: rgba(61, 64, 58, 0.3);
      border-radius: 3px;
    }

    .dark .logo-slider-track {
      scrollbar-color: rgba(135, 139, 128, 0.3) transparent;
    }

    .dark .logo-slider-track::-webkit-scrollbar-thumb {
      background-color: rgba(135, 139, 128, 0.3);
    }
  }

  /* Touch device optimizations */
  @media (hover: none) and (pointer: coarse) {
    .logo-slider-track {
      animation-play-state: paused;
    }

    .logo-slider-container:active .logo-slider-track {
      animation-play-state: running;
    }
  }
</style>

<script>
  // Minimal JavaScript for enhanced pause on focus and touch
  // This is necessary for proper pause behavior on focus and touch devices
  (function() {
    const sliderTrack = document.getElementById('logo-slider-track');
    const sliderContainer = document.getElementById('logo-slider-wrapper')?.parentElement;
    
    if (!sliderTrack || !sliderContainer) return;

    let isPaused = false;
    let touchStartX = 0;
    let touchStartY = 0;

    // Pause on focus
    sliderContainer.addEventListener('focusin', () => {
      if (!isPaused) {
        sliderTrack.style.animationPlayState = 'paused';
        isPaused = true;
      }
    });

    // Resume on blur (if no focusable element is focused)
    sliderContainer.addEventListener('focusout', (e) => {
      // Check if focus moved outside the container
      setTimeout(() => {
        if (!sliderContainer.contains(document.activeElement)) {
          sliderTrack.style.animationPlayState = 'running';
          isPaused = false;
        }
      }, 0);
    });

    // Pause on touch start
    sliderContainer.addEventListener('touchstart', (e) => {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
      sliderTrack.style.animationPlayState = 'paused';
      isPaused = true;
    });

    // Resume on touch end (after a delay to prevent immediate restart)
    sliderContainer.addEventListener('touchend', () => {
      setTimeout(() => {
        if (!sliderContainer.matches(':focus-within')) {
          sliderTrack.style.animationPlayState = 'running';
          isPaused = false;
        }
      }, 500);
    });

    // Pause on mouse enter (additional to CSS hover)
    sliderContainer.addEventListener('mouseenter', () => {
      if (!isPaused) {
        sliderTrack.style.animationPlayState = 'paused';
        isPaused = true;
      }
    });

    // Resume on mouse leave
    sliderContainer.addEventListener('mouseleave', () => {
      if (!sliderContainer.matches(':focus-within')) {
        sliderTrack.style.animationPlayState = 'running';
        isPaused = false;
      }
    });
  })();
</script>
